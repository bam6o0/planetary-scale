<!doctype html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=Hatena::Bookmark content="nocomment"><title>開発環境の構築につかれた。 | Planetary Scale</title><link href="https://fonts.googleapis.com/css?family=Lato%3a900" rel=stylesheet type=text/css><link rel=stylesheet href=https://bam6o0.github.io/planetary-scale/css/main.css><link href=https://bam6o0.github.io/planetary-scale/index.xml rel=alternate type=application/rss+xml><meta name=title content="https://bam6o0.github.io/planetary-scale/what-is-devenv/"><link rel=canonical href=https://bam6o0.github.io/planetary-scale/what-is-devenv/><meta property="og:title" content="開発環境の構築につかれた。"><meta property="og:url" content="https://bam6o0.github.io/planetary-scale/what-is-devenv/"></head><body><section class=site-nav><header><nav id=navigation><a class=name href=https://bam6o0.github.io/planetary-scale>Planetary Scale</a></nav></header></section><article><div class=container><header><div class=meta><time pubdate datetime=2020-09-23 title=2020-09-23>September 23, 2020</time></div><h1 class=title>開発環境の構築につかれた。</h1></header><section><p>ソフトウェアエンジニアと開発環境構築は切っても切れない関係だといえる。せめて環境構築といい関係を構築したい。</p><h2 id=なぜ疲れたのか>なぜ疲れたのか</h2><h3 id=macを使っていたころ>macを使っていたころ</h3><p>学生時代はMacをメイン機で開発していた。何か必要なたびにbrewコマンドを使ってパッケージをインストールして試してみるを繰り返してるうちに、パッケージが増えすぎて容量を食っていた。
正直Macの中は全く整理されていないカオスな状況で、バージョンの不一致による問題や、二重インストールなど諸所の問題がよく起きていた。
またサーバーにデプロイするタイミングで、Linuxに各種ツールをインストールする必要があり、本番環境構築が一番自身がない感じになると状況だった。</p><h3 id=windowsでjava開発>windowsでjava開発</h3><p>就職してからはJavaとAngularを使ったプロダクト開発を始めた。高校生ぶりのWindowsに戸惑いながらも、Java開発をする分にはWindowsでも特に問題ないなといった感じで仕事をしていた。
この時は誰がメンテしているのかも知らない環境設定スクリプト(batファイル)を叩いて、数時間後に環境が出来上がってるといった感じで、自分でメンテナンスする気は全く起きない状況だった。ただ配属当初は環境が悪いのか、コードが悪いのかの切り分けができずよく頭を抱えた。</p><h3 id=sreとしてlinux需要>SREとしてLinux需要</h3><p>その後SREへ異動してきて状況は一変した。オペレーションやオンコールでAWS上のインスタンスへSSH、ネットワーク系のコマンド、MySQLクライアント・PostgreSQLを多用するようになった。
この時からLinux系ターミナルが必要となり、とりあえずでWSLをよく使うようになった。WSLは悪くはないが、ファイルシステムが遅かったり、systemdがプロセス1で動いてなかったりと、微妙なLinuxとの違いが逆に気になる感じだった。</p><p>またAWS CLIを使うためのMFA認証やVagrant・Ansibleを使った検証、DockerやDocker-composeを使ったオペレーションツールなど、即席でインストールして対応していた。
いつ書いたかかよくわからにコンフィグが大量に残ってくると、ミドルウェアをローカルで検証するのも一苦労である。</p><p>この時点で環境を作り直したいと思いに心が蝕まれていった。</p><h3 id=異動やコロナ>異動やコロナ</h3><p>また異動に伴いPCのリプレイス、リモートワークに伴うPCの配布、自宅PC買い替えなど、環境構築する機会自体も増えてきた。
ソフトウェアエンジニアをやり続ける上で今後もかならず発生するイベントであることは間違いない。
毎回その場で調べて色々インストールしていたが、SREとして自分の開発環境構築をコードかしないのは職務怠慢ではと思い、考えてみることにした。</p><h2 id=最低必要だった要件>最低必要だった要件</h2><ol><li>Windows, macOS, Linuxで流用可能</li><li>Docker, Docker-composeでコンテナ開発ができる。</li><li>AWS-CLI, AWS-CDKを使ってすぐにクラウド開発ができる。</li><li>いつでも環境をリセットして再構築できる。</li></ol><p>現職的な理由でクラウドネイティブ開発に寄っている。</p><h2 id=作ったもの>作ったもの</h2><p><a href=https://github.com/bam6o0/devenv>bam6o0/devenv</a></p><p>vagrantとVirtusBoxを利用して完全VM上での環境に移行することにより、ホストのOS依存や環境汚染を最小限にした。
各種必要なソフトウェアのインストールや設定などはprovisionにスクリプトとして書き、構築時点ですべてが揃っている状態にした。
各種パラメータやトークン情報などはvagrant-envを使い、<code>.env</code>で外だしできるようにした。</p><p>特に<code>aws-mfa</code>が即実行できるのは魅力的だ。</p><p>VMの設定でホストのPCとフォルダを共有する設定がよくあるが、devevnは完全に独立している。共有はホスト環境とのファイルシステムの違いや権限など様々な問題の原因になるため個人的には非推奨である。
ポートは<code>80</code>と<code>8080</code>をポートフォワーディングしている。正直ポートは指定すればこの二つだけで十分だと思う。
コードやコンテナイメージのホスティングサービス、クラウドサービスを積極的に活用することが現代らしい開発環境ではないだろうかと思う。</p><h2 id=まとめ>まとめ</h2><p>正直現状はVagrantfileに各種セットアップのためのコマンドを書きなぐった程度のものだが、今後の環境構築コストは大幅に短縮できるようになった。
また環境構築の知識と経験を資産にでき、改善のためのPDCAを回せるようになった点も大きい。</p><p>なにより、常に真っ新な環境で新規開発を始めれる喜び、これに勝るものはなし。</p><div class=social><a href=https://twitter.com/share class=twitter-share-button data-via=bam6o0 data-count=none>Tweet</a></div><div class=meta><a href=https://github.com/bam6o0/planetary-scale/commits/master/content/posts/what-is-devenv.md>update history</a></div></section><footer><address><p>Written by <strong><a rel=author href=https://twitter.com/bam6o0 title="Takato Sasagawa" target=_blank>Takato Sasagawa</a></strong><br><span class=muted>Site Reliability Engineer</span></p></address></footer></div></article><script type=text/javascript src=//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js></script><script type=text/javascript src=/js/main.js></script><script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document,'script','twitter-wjs');</script><script>$(document).ready(function(){$('p:has(img)').css('text-align','center');$('iframe').css('style','display: block; margin: 0px auto;');});</script>